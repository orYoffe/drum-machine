var e=function(e){"use strict";class t{constructor(){this.audioContext=null,this.isInitialized=!1,this.audioSources=new Map,this.sampleRate=44100,this.latencyHint="interactive"}async initialize(){try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext)({latencyHint:this.latencyHint,sampleRate:this.sampleRate,...navigator.userAgent.includes("Mobile")&&{latencyHint:"balanced",sampleRate:22050}}),this.isInitialized=!0,this.audioContext.state,!0}catch(e){return this.isInitialized=!1,!1}}async resumeAudioContext(){try{if(!this.audioContext||!this.isInitialized)return!1;if("function"!=typeof this.audioContext.resume)return!1;if("suspended"===this.audioContext.state)try{return await this.audioContext.resume(),!0}catch(e){return!1}else{if("running"===this.audioContext.state)return!0;if("closed"===this.audioContext.state)return!1}return!0}catch(e){return!1}}checkAudioContextHealth(){if(!this.audioContext||!this.isInitialized)return{healthy:!1,state:"not-initialized",message:"Audio context not initialized"};switch(this.audioContext.state){case"running":return{healthy:!0,state:"running",message:"Audio context running normally"};case"suspended":return{healthy:!1,state:"suspended",message:"Audio context suspended - needs user interaction"};case"closed":return{healthy:!1,state:"closed",message:"Audio context closed - cannot recover"};default:return{healthy:!1,state:"unknown",message:"Unknown audio context state"}}}async restoreAudioContext(){try{return this.audioContext&&this.isInitialized?"closed"===this.audioContext.state?await this.initialize():"suspended"!==this.audioContext.state||await this.resumeAudioContext():await this.initialize()}catch(e){return!1}}createBufferSource(){if(!this.audioContext||!this.isInitialized)throw new Error("Audio context not available");const e=this.audioContext.createBufferSource(),t=Date.now()+Math.random();return this.audioSources.set(t,e),e.onended=()=>{this.audioSources.delete(t)},{source:e,sourceId:t}}getDestination(){if(!this.audioContext||!this.isInitialized)throw new Error("Audio context not available");return this.audioContext.destination}getState(){return this.audioContext&&this.isInitialized?this.audioContext.state:"not-initialized"}isRunning(){return"running"===this.getState()}isSuspended(){return"suspended"===this.getState()}isClosed(){return"closed"===this.getState()}createGainNode(){if(!this.audioContext||!this.isInitialized)throw new Error("Audio context not available");return this.audioContext.createGain()}async decodeAudioData(e){if(!this.audioContext||!this.isInitialized)throw new Error("Audio context not available");return await this.audioContext.decodeAudioData(e)}createAudioBuffer(e,t,a){if(!this.audioContext||!this.isInitialized)throw new Error("Audio context not available");return this.audioContext.createBuffer(e,t,a)}stopAllSources(){this.audioSources.forEach((e,t)=>{try{"playing"===e.state&&e.stop()}catch(e){}}),this.audioSources.clear()}destroy(){try{this.stopAllSources(),this.audioContext&&"closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null,this.isInitialized=!1}catch(e){}}getInfo(){return this.audioContext&&this.isInitialized?{initialized:!0,state:this.audioContext.state,sampleRate:this.audioContext.sampleRate,activeSourceCount:this.audioSources.size,latencyHint:this.latencyHint}:{initialized:!1}}}const a={DEFAULT:120,MIN:60,MAX:200,STEP:1},i={DEFAULT_LENGTH:16,OPTIONS:[4,8,16,32],MIN_LENGTH:4,MAX_LENGTH:32},s=["kick","snare","hihat","crash","tom1","tom2","ride","clap","bass"],n={TOTAL_KEYS:24,WHITE_KEYS:14,BLACK_KEYS:10,DEFAULT_VELOCITY:.8,SAMPLE_RETRY_ATTEMPTS:3,SAMPLE_RETRY_DELAY:1e3},r=[{note:"C",key:"Q",type:"white",index:1,frequency:261.63},{note:"C#",key:"A",type:"black",index:2,frequency:277.18},{note:"D",key:"W",type:"white",index:3,frequency:293.66},{note:"D#",key:"S",type:"black",index:4,frequency:311.13},{note:"E",key:"E",type:"white",index:5,frequency:329.63},{note:"F",key:"R",type:"white",index:6,frequency:349.23},{note:"F#",key:"F",type:"black",index:7,frequency:369.99},{note:"G",key:"T",type:"white",index:8,frequency:392},{note:"G#",key:"G",type:"black",index:9,frequency:415.3},{note:"A",key:"Y",type:"white",index:10,frequency:440},{note:"A#",key:"H",type:"black",index:11,frequency:466.16},{note:"B",key:"U",type:"white",index:12,frequency:493.88},{note:"C",key:"I",type:"white",index:13,frequency:523.25},{note:"C#",key:"J",type:"black",index:14,frequency:554.37},{note:"D",key:"O",type:"white",index:15,frequency:587.33},{note:"D#",key:"K",type:"black",index:16,frequency:622.25},{note:"E",key:"P",type:"white",index:17,frequency:659.25},{note:"F",key:"Z",type:"white",index:18,frequency:698.46},{note:"F#",key:"X",type:"black",index:19,frequency:739.99},{note:"G",key:"C",type:"white",index:20,frequency:783.99},{note:"G#",key:"V",type:"black",index:21,frequency:830.61},{note:"A",key:"B",type:"white",index:22,frequency:880},{note:"A#",key:"N",type:"black",index:23,frequency:932.33},{note:"B",key:"M",type:"white",index:24,frequency:987.77}],o={MOBILE_BREAKPOINT:768,TABLET_BREAKPOINT:1024,DESKTOP_BREAKPOINT:1200},l={BEATS:"drumMachineBeats",THEME:"drumMachineTheme",MUTE_STATE:"drumMachineMuteState",LAST_USED_BEAT:"drumMachineLastUsedBeat"},d={ANIMATION_DURATION:200,MODAL_BACKDROP_OPACITY:.5,TOOLTIP_DELAY:500,DEBOUNCE_DELAY:300},h={AUDIO_CONTEXT_FAILED:"Failed to initialize audio context",SAMPLE_LOAD_FAILED:"Failed to load audio sample",STORAGE_FAILED:"Failed to save to local storage",INVALID_BEAT_DATA:"Invalid beat data structure",BEAT_NAME_EMPTY:"Beat name cannot be empty",BEAT_NAME_CONFLICT:"Beat name already exists",INITIALIZATION_FAILED:"Failed to initialize application",INVALID_URL_DATA:"Invalid beat data in URL",LOAD_FAILED:"Failed to load beat",SAVE_FAILED:"Failed to save beat",SHARE_FAILED:"Failed to share beat",COPY_FAILED:"Failed to copy to clipboard",MODAL_FAILED:"Failed to show modal",PLAYBACK_FAILED:"Failed to start playback"},c={BEAT_SAVED:"Beat saved successfully",BEAT_LOADED:"Beat loaded successfully",BEAT_DELETED:"Beat deleted successfully",SHARE_LINK_COPIED:"Share link copied to clipboard",THEME_CHANGED:"Theme changed successfully",BEAT_LOADED_FROM_URL:"Beat loaded from shared link",LINK_COPIED:"Link copied to clipboard"},u={LOADING_SAMPLES:"ðŸŽµ Loading audio samples...",LOADING_PIANO:"ðŸŽ¹ Loading piano samples...",AUDIO_SUSPENDED:"ðŸŽµ Audio suspended - click to resume",AUDIO_RUNNING:"ðŸŽµ Audio running normally",AUDIO_CLOSED:"ðŸŽµ Audio context closed - cannot recover"},p={tempo:a.DEFAULT,patternLength:i.DEFAULT_LENGTH,sequencer:{}};s.forEach(e=>{p.sequencer[e]=new Array(i.DEFAULT_LENGTH).fill(!1)});const y=()=>JSON.parse(JSON.stringify(p)),m={TEMPO:{min:a.MIN,max:a.MAX,type:"number"},PATTERN_LENGTH:{min:i.MIN_LENGTH,max:i.MAX_LENGTH,type:"number",allowed:i.OPTIONS},BEAT_NAME:{minLength:1,maxLength:50,type:"string"}},E={DRUMS:"sounds/",PIANO:"sounds/piano/",PIANO_SAMPLE_PREFIX:"key",PIANO_SAMPLE_EXTENSION:".mp3"},g={DESKTOP:{WHITE_KEY_WIDTH:50,WHITE_KEY_HEIGHT:200,BLACK_KEY_WIDTH:30,BLACK_KEY_HEIGHT:120,BLACK_KEY_OFFSET:45},MOBILE:{WHITE_KEY_WIDTH:"100%",WHITE_KEY_HEIGHT:"40px",BLACK_KEY_WIDTH:"50%",BLACK_KEY_HEIGHT:"30px",BLACK_KEY_OFFSET:35}},S={AUDIO_CONFIG:{DEFAULT_SAMPLE_RATE:44100,MOBILE_SAMPLE_RATE:22050,LATENCY_HINT:"interactive",MOBILE_LATENCY_HINT:"balanced"},TEMPO_CONFIG:a,PATTERN_CONFIG:i,DRUM_TYPES:s,PIANO_CONFIG:n,PIANO_KEYS:r,RESPONSIVE_CONFIG:o,STORAGE_KEYS:l,THEME_CONFIG:{LIGHT:"light",DARK:"dark",SYSTEM:"system"},UI_CONFIG:d,ERROR_MESSAGES:h,SUCCESS_MESSAGES:c,STATUS_MESSAGES:u,VALIDATION_RULES:m,SAMPLE_PATHS:E,PIANO_LAYOUT:g};class A{constructor(){this.storageKey=l.BEATS,this.beats=this.loadAllBeats()}saveBeat(e,t,a=!1){try{const i=this.validateBeatName(e);if(!i.valid)return{success:!1,message:i.message};const s=this.validateBeatData(t);if(!s.valid)return{success:!1,message:s.message};const n=this.getBeatByName(e);if(n&&!a)return{success:!1,message:h.BEAT_NAME_CONFLICT,conflict:!0,existingBeat:n};const r={name:e.trim(),data:{...t},timestamp:Date.now(),lastUsed:Date.now()};if(n){const t=this.beats.findIndex(t=>t.name===e);this.beats[t]=r}else this.beats.push(r);return this.persistBeats(),{success:!0,message:c.BEAT_SAVED,beat:r}}catch(e){return{success:!1,message:h.STORAGE_FAILED}}}loadBeat(e){try{const t=this.getBeatByName(e);return t?(t.lastUsed=Date.now(),this.persistBeats(),t):null}catch(e){return null}}loadAllBeats(){try{const e=localStorage.getItem(this.storageKey);if(!e)return[];const t=JSON.parse(e);if(!Array.isArray(t))return this.clearAllBeats(),[];const a=t.filter(e=>this.isValidBeatStructure(e));return a.length!==t.length&&(this.beats=a,this.persistBeats()),a}catch(e){return this.clearAllBeats(),[]}}deleteBeat(e){try{const t=this.beats.length;return this.beats=this.beats.filter(t=>t.name!==e),this.beats.length===t?{success:!1,message:`Beat "${e}" not found`}:(this.persistBeats(),{success:!0,message:c.BEAT_DELETED})}catch(e){return{success:!1,message:h.STORAGE_FAILED}}}getLastUsedBeat(){return 0===this.beats.length?null:this.beats.reduce((e,t)=>t.lastUsed>e.lastUsed?t:e)}getBeatByName(e){return this.beats.find(t=>t.name===e)||null}beatNameExists(e){return this.beats.some(t=>t.name===e)}getAllBeatNames(){return this.beats.map(e=>e.name)}getBeatCount(){return this.beats.length}clearAllBeats(){try{return this.beats=[],this.persistBeats(),{success:!0,message:"All beats cleared successfully"}}catch(e){return{success:!1,message:h.STORAGE_FAILED}}}handleNameConflict(e){let t=1,a=e;for(;this.beatNameExists(a);)a=`${e} (${t})`,t++;return a}validateBeatName(e){if(!e||"string"!=typeof e)return{valid:!1,message:h.BEAT_NAME_EMPTY};const t=e.trim();return 0===t.length?{valid:!1,message:h.BEAT_NAME_EMPTY}:t.length>m.BEAT_NAME.maxLength?{valid:!1,message:`Beat name too long (max ${m.BEAT_NAME.maxLength} characters)`}:{valid:!0,message:""}}validateBeatData(e){return e&&"object"==typeof e?"number"!=typeof e.tempo||e.tempo<m.TEMPO.min||e.tempo>m.TEMPO.max?{valid:!1,message:`Tempo must be between ${m.TEMPO.min} and ${m.TEMPO.max}`}:"number"==typeof e.patternLength&&m.PATTERN_LENGTH.allowed.includes(e.patternLength)?e.sequencer&&"object"==typeof e.sequencer?{valid:!0,message:""}:{valid:!1,message:"Sequencer data is required"}:{valid:!1,message:`Pattern length must be one of: ${m.PATTERN_LENGTH.allowed.join(", ")}`}:{valid:!1,message:h.INVALID_BEAT_DATA}}isValidBeatStructure(e){return!(!e||"object"!=typeof e)&&(!(!e.name||"string"!=typeof e.name)&&(!(!e.data||"object"!=typeof e.data)&&("number"==typeof e.timestamp&&("number"==typeof e.lastUsed&&this.validateBeatData(e.data).valid))))}cleanupCorruptedData(){const e=this.beats.length;this.beats=this.beats.filter(e=>this.isValidBeatStructure(e));const t=e-this.beats.length;return t>0&&this.persistBeats(),t}exportBeats(){try{return JSON.stringify(this.beats,null,2)}catch(e){return"[]"}}importBeats(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,message:"Invalid import format - expected array of beats"};const a=t.filter(e=>this.isValidBeatStructure(e)),i=t.length-a.length;if(0===a.length)return{success:!1,message:"No valid beats found in import data"};let s=0;return a.forEach(e=>{const t=e.name;for(;this.beatNameExists(e.name);)e.name=`${t}_${Date.now()}`;e.timestamp=Date.now(),e.lastUsed=Date.now(),this.beats.push(e),s++}),this.persistBeats(),{success:!0,message:`Imported ${s} beats successfully${i>0?` (${i} invalid entries skipped)`:""}`,importedCount:s,invalidCount:i}}catch(e){return{success:!1,message:"Invalid JSON format"}}}getStorageStats(){const e=new Blob([JSON.stringify(this.beats)]).size,t=this.beats.length>0?e/this.beats.length:0;return{totalBeats:this.beats.length,totalSize:e,averageBeatSize:Math.round(t),storageKey:this.storageKey,lastUpdated:this.beats.length>0?Math.max(...this.beats.map(e=>e.timestamp)):null}}persistBeats(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.beats))}catch(e){throw new Error(h.STORAGE_FAILED)}}refresh(){this.beats=this.loadAllBeats()}}class T{constructor(e){this.audioManager=e,this.pianoSamples=new Map,this.isInitialized=!1,this.container=null,this.keys=new Map,this.activeTouches=new Map,this.isMobile=window.innerWidth<=o.MOBILE_BREAKPOINT,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTouchCancel=this.handleTouchCancel.bind(this),this.handleResize=this.handleResize.bind(this)}async initialize(e){try{return this.container=e,this.createPianoKeys(),this.bindPianoEvents(),await this.loadPianoSamples(),this.setupResponsiveHandling(),this.isInitialized=!0,!0}catch(e){return!1}}createPianoKeys(){if(!this.container)return;this.container.innerHTML="",this.keys.clear();r.filter(e=>"white"===e.type).forEach((e,t)=>{const a=this.createKeyElement(e,t);this.keys.set(e.index,a),this.container.appendChild(a)});r.filter(e=>"black"===e.type).forEach(e=>{const t=this.createKeyElement(e);this.positionBlackKey(t,e),this.keys.set(e.index,t),this.container.appendChild(t)})}createKeyElement(e,t=null){const a=document.createElement("div");return a.className=`piano-key ${e.type}`,a.dataset.keyIndex=e.index,a.dataset.note=e.note,a.dataset.keyboardKey=e.key,this.isMobile?a.innerHTML=`<span class="piano-key-label">${e.note}</span>`:a.innerHTML=`<span class="piano-key-label">${e.note}</span><span class="piano-keyboard-key">${e.key}</span>`,"white"===e.type?this.isMobile?(a.style.height=g.MOBILE.WHITE_KEY_HEIGHT,a.style.width=g.MOBILE.WHITE_KEY_WIDTH):(a.style.width=`${g.DESKTOP.WHITE_KEY_WIDTH}px`,a.style.height=`${g.DESKTOP.WHITE_KEY_HEIGHT}px`,null!==t&&(a.style.left=t*g.DESKTOP.WHITE_KEY_WIDTH+"px")):this.isMobile?(a.style.height=g.MOBILE.BLACK_KEY_HEIGHT,a.style.width=g.MOBILE.BLACK_KEY_WIDTH):(a.style.width=`${g.DESKTOP.BLACK_KEY_WIDTH}px`,a.style.height=`${g.DESKTOP.BLACK_KEY_HEIGHT}px`),a}positionBlackKey(e,t){if(this.isMobile){const a=this.getWhiteKeyIndexForBlackKey(t.index)*parseInt(g.MOBILE.WHITE_KEY_HEIGHT);e.style.left="35px",e.style.top=`${a+35}px`,e.style.right="0"}else{const a=this.getWhiteKeyIndexForBlackKey(t.index)*g.DESKTOP.WHITE_KEY_WIDTH+g.DESKTOP.BLACK_KEY_OFFSET;e.style.left=`${a}px`,e.style.top="0"}}getWhiteKeyIndexForBlackKey(e){return{2:0,4:1,7:3,9:4,11:5,14:6,16:7,19:9,21:10,23:11}[e]||0}async loadPianoSamples(){try{this.updateStatus(u.LOADING_PIANO);const e=r.map(async e=>{const t=`${E.PIANO}${E.PIANO_SAMPLE_PREFIX}${e.index.toString().padStart(2,"0")}${E.PIANO_SAMPLE_EXTENSION}`;try{const a=await this.loadPianoSampleWithRetry(t);return this.pianoSamples.set(e.index,a),!0}catch(t){return this.pianoSamples.set(e.index,null),!1}}),t=(await Promise.allSettled(e)).filter(e=>"fulfilled"===e.status&&e.value).length;return this.updateStatus(`ðŸŽ¹ Piano samples loaded: ${t}/${n.TOTAL_KEYS}`),t>0}catch(e){return this.updateStatus("ðŸŽ¹ Failed to load piano samples"),!1}}async loadPianoSampleWithRetry(e){let t;for(let a=1;a<=n.SAMPLE_RETRY_ATTEMPTS;a++)try{return await this.loadPianoSample(e)}catch(e){if(t=e,a<n.SAMPLE_RETRY_ATTEMPTS){const e=n.SAMPLE_RETRY_DELAY*Math.pow(2,a-1);await new Promise(t=>setTimeout(t,e))}}throw t}async loadPianoSample(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const a=await t.arrayBuffer();return await this.audioManager.decodeAudioData(a)}catch(e){throw new Error(`Failed to load piano sample: ${e.message}`)}}playPianoKey(e,t=n.DEFAULT_VELOCITY){try{if(!this.audioManager||!this.audioManager.isInitialized)return!1;const a=this.pianoSamples.get(e);if(a)return this.audioManager.playBufferSource(a,t),!0;const i=r.find(t=>t.index===e);if(i&&i.frequency){const e=this.createSynthesizedPianoSound(i.frequency);return this.audioManager.playBufferSource(e,t),!0}return!1}catch(e){return!1}}createSynthesizedPianoSound(e){try{const t=this.audioManager.audioContext.sampleRate,a=.5,i=Math.floor(t*a),s=this.audioManager.createAudioBuffer(1,i,t),n=s.getChannelData(0);for(let a=0;a<i;a++){const i=a/t,s=Math.exp(3*-i);n[a]=Math.sin(2*Math.PI*e*i)*s*.3}return s}catch(e){return null}}bindPianoEvents(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("touchstart",this.handleTouchStart),document.addEventListener("touchend",this.handleTouchEnd),document.addEventListener("touchcancel",this.handleTouchCancel),this.isMobile||this.keys.forEach(e=>{e.addEventListener("mousedown",()=>this.handleKeyPress(e)),e.addEventListener("mouseup",()=>this.handleKeyRelease(e)),e.addEventListener("mouseleave",()=>this.handleKeyRelease(e))})}handleKeyDown(e){if(this.isMobile)return;const t=r.find(t=>t.key===e.key.toUpperCase());if(t){e.preventDefault();const a=this.keys.get(t.index);a&&!a.classList.contains("active")&&this.handleKeyPress(a)}}handleKeyUp(e){if(this.isMobile)return;const t=r.find(t=>t.key===e.key.toUpperCase());if(t){e.preventDefault();const a=this.keys.get(t.index);a&&a.classList.contains("active")&&this.handleKeyRelease(a)}}handleTouchStart(e){let t=!1;e.changedTouches.forEach(e=>{const a=e.identifier,i=document.elementFromPoint(e.clientX,e.clientY),s=i?.closest(".piano-key");s&&(t=!0,this.activeTouches.set(a,s),this.handleKeyPress(s))}),t&&e.preventDefault()}handleTouchEnd(e){let t=!1;e.changedTouches.forEach(e=>{const a=e.identifier,i=this.activeTouches.get(a);i&&(t=!0,this.activeTouches.delete(a),this.handleKeyRelease(i))}),t&&e.preventDefault()}handleTouchCancel(e){let t=!1;e.changedTouches.forEach(e=>{const a=e.identifier,i=this.activeTouches.get(a);i&&(t=!0,this.activeTouches.delete(a),this.handleKeyRelease(i))}),t&&e.preventDefault()}handleKeyPress(e){if(!e||e.classList.contains("active"))return;e.classList.add("active");const t=parseInt(e.dataset.keyIndex);this.playPianoKey(t)}handleKeyRelease(e){e&&e.classList.remove("active")}setupResponsiveHandling(){window.addEventListener("resize",this.handleResize),this.handleResize()}handleResize(){const e=this.isMobile;this.isMobile=window.innerWidth<=o.MOBILE_BREAKPOINT,e!==this.isMobile&&(this.createPianoKeys(),this.bindPianoEvents())}updateStatus(e){}getState(){return{isInitialized:this.isInitialized,isMobile:this.isMobile,totalKeys:n.TOTAL_KEYS,loadedSamples:this.pianoSamples.size,activeTouches:this.activeTouches.size}}destroy(){try{document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("touchstart",this.handleTouchStart),document.removeEventListener("touchend",this.handleTouchEnd),document.removeEventListener("touchcancel",this.handleTouchCancel),window.removeEventListener("resize",this.handleResize),this.keys.clear(),this.activeTouches.clear(),this.pianoSamples.clear(),this.container=null,this.audioManager=null,this.isInitialized=!1}catch(e){}}}class b{constructor(e,t={}){this.container=e,this.options={patternLength:t.patternLength||i.DEFAULT_LENGTH,drumTypes:t.drumTypes||[...s],cellSize:t.cellSize||40,cellGap:t.cellGap||2,...t},this.grid=new Map,this.isPlaying=!1,this.currentStep=0,this.animationFrame=null,this.initializeGrid(),this.handleCellClick=this.handleCellClick.bind(this),this.handleCellHover=this.handleCellHover.bind(this),this.updateGridDisplay=this.updateGridDisplay.bind(this)}initializeGrid(){this.grid.clear(),this.options.drumTypes.forEach(e=>{const t=new Map;for(let e=0;e<this.options.patternLength;e++)t.set(e,!1);this.grid.set(e,t)})}createGrid(){try{return!!this.container&&(this.container.innerHTML="",this.options.drumTypes.forEach((e,t)=>{const a=document.createElement("div");a.className="grid-row",a.style.gridTemplateColumns=`repeat(${this.options.patternLength}, 1fr)`;for(let i=0;i<this.options.patternLength;i++){const s=document.createElement("div");s.className="grid-cell",s.dataset.row=t,s.dataset.step=i,s.dataset.drum=e,s.addEventListener("click",()=>this.handleCellClick(s,e,i)),a.appendChild(s)}this.container.appendChild(a)}),this.bindGridEvents(),!0)}catch(e){return!1}}bindGridEvents(){}handleCellClick(e,t,a){t&&void 0!==a&&(this.toggleStep(t,a),this.updateCellDisplay(e,t,a),this.options.onStepToggle&&this.options.onStepToggle(t,a))}handleCellHover(e,t){if(t)e.style.backgroundColor="var(--accent-color)",e.style.opacity="0.8";else{const t=e.dataset.drum,a=parseInt(e.dataset.step);this.updateCellDisplay(e,t,a)}}updateCellDisplay(e,t,a){if(!e||!t||void 0===a)return;this.getStepState(t,a)?(e.style.backgroundColor="var(--accent-color)",e.style.borderColor="var(--accent-color-dark)"):(e.style.backgroundColor="var(--background-secondary)",e.style.borderColor="var(--border-color)"),e.style.opacity="1"}updateGridDisplay(){this.options.drumTypes.forEach(e=>{for(let t=0;t<this.options.patternLength;t++){const a=this.container.querySelector(`[data-drum="${e}"][data-step="${t}"]`);a&&this.updateCellDisplay(a,e,t)}})}toggleStep(e,t){if(!this.validateStep(e,t))return!1;const a=this.grid.get(e);if(!a)return!1;const i=!(a.get(t)||!1);return a.set(t,i),i}getStepState(e,t){if(!this.validateStep(e,t))return!1;const a=this.grid.get(e);return a&&a.get(t)||!1}setStepState(e,t,a){if(!this.validateStep(e,t))return!1;const i=this.grid.get(e);return!!i&&(i.set(t,Boolean(a)),!0)}validateStep(e,t){return!(!e||"string"!=typeof e)&&(!("number"!=typeof t||t<0||t>=this.options.patternLength)&&!!this.options.drumTypes.includes(e))}updateGridSize(e){if(!this.validatePatternLength(e))return!1;try{return this.options.patternLength=e,this.initializeGrid(),this.createGrid(),!0}catch(e){return!1}}validatePatternLength(e){return"number"==typeof e&&e>=m.PATTERN_LENGTH.min&&e<=m.PATTERN_LENGTH.max&&m.PATTERN_LENGTH.allowed.includes(e)}clearGrid(){try{return this.grid.forEach(e=>{e.forEach((t,a)=>{e.set(a,!1)})}),this.updateGridDisplay(),!0}catch(e){return!1}}getSequencerData(){const e={};return this.grid.forEach((t,a)=>{e[a]=Array.from(t.values())}),e}setSequencerData(e){if(!e||"object"!=typeof e)return!1;try{return this.initializeGrid(),Object.entries(e).forEach(([e,t])=>{if(this.options.drumTypes.includes(e)&&Array.isArray(t)){const a=this.grid.get(e);a&&t.forEach((e,t)=>{t<this.options.patternLength&&a.set(t,Boolean(e))})}}),this.updateGridDisplay(),!0}catch(e){return!1}}optimizeSequencerData(){const e={};return this.grid.forEach((t,a)=>{const i=[];t.forEach((e,t)=>{e&&i.push(t)}),i.length>0&&(e[a]=i)}),e}getStatistics(){const e={totalSteps:this.options.patternLength,totalDrumTypes:this.options.drumTypes.length,activeSteps:0,drumTypeStats:{}};return this.grid.forEach((t,a)=>{let i=0;t.forEach(e=>{e&&i++}),e.activeSteps+=i,e.drumTypeStats[a]={active:i,total:this.options.patternLength,percentage:Math.round(i/this.options.patternLength*100)}}),e.totalActivePercentage=Math.round(e.activeSteps/(this.options.patternLength*this.options.drumTypes.length)*100),e}startPlayback(e){if(this.isPlaying)return;this.isPlaying=!0,this.currentStep=0;const t=60/e/4;let a=0;const i=e=>{if(!this.isPlaying)return;(e-a)/1e3>=t&&(this.highlightCurrentStep(this.currentStep),this.currentStep=(this.currentStep+1)%this.options.patternLength,a=e),this.animationFrame=requestAnimationFrame(i)};this.animationFrame=requestAnimationFrame(i)}stopPlayback(){this.isPlaying=!1,this.currentStep=0,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.clearStepHighlighting()}highlightCurrentStep(e){this.clearStepHighlighting(),this.options.drumTypes.forEach(t=>{const a=this.container.querySelector(`[data-drum="${t}"][data-step="${e}"]`);a&&(a.style.boxShadow="0 0 10px var(--accent-color)",a.style.transform="scale(1.1)",a.style.transition="all 0.1s ease")})}clearStepHighlighting(){this.container.querySelectorAll(".grid-cell").forEach(e=>{e.style.boxShadow="none",e.style.transform="scale(1)"})}getState(){return{isPlaying:this.isPlaying,currentStep:this.currentStep,patternLength:this.options.patternLength,drumTypes:this.options.drumTypes,gridData:this.getSequencerData(),statistics:this.getStatistics()}}destroy(){try{this.stopPlayback(),this.container&&(this.container.innerHTML=""),this.grid.clear(),this.container=null}catch(e){}}}class f{constructor(){this.modals=new Map,this.activeModal=null,this.modalBackdrop=null,this.isInitialized=!1,this.templates={beatSelection:this.createBeatSelectionTemplate(),saveBeat:this.createSaveBeatTemplate()},this.handleModalClose=this.handleModalClose.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this),this.handleEscapeKey=this.handleEscapeKey.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.initialize()}initialize(){try{return this.createModalBackdrop(),this.bindGlobalEvents(),this.isInitialized=!0,!0}catch(e){return!1}}createModalBackdrop(){this.modalBackdrop=document.createElement("div"),this.modalBackdrop.className="modal-backdrop",this.modalBackdrop.style.cssText=`\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background-color: rgba(0, 0, 0, ${d.MODAL_BACKDROP_OPACITY});\n      z-index: 9998;\n      opacity: 0;\n      visibility: hidden;\n      transition: opacity ${d.ANIMATION_DURATION}ms ease, visibility ${d.ANIMATION_DURATION}ms ease;\n    `,this.modalBackdrop.addEventListener("click",this.handleBackdropClick),document.body.appendChild(this.modalBackdrop)}bindGlobalEvents(){document.addEventListener("keydown",this.handleEscapeKey)}showBeatSelectionModal(e=[],t=null){try{const a="beat-selection-modal";let i=this.modals.get(a);return i||(i=this.createModal(a,this.templates.beatSelection),this.modals.set(a,i)),this.populateBeatList(i,e),t&&"function"==typeof t&&(i.dataset.onBeatSelect="true",i.onBeatSelect=t),this.showModal(i),!0}catch(e){return!1}}hideBeatSelectionModal(){return this.hideModal("beat-selection-modal")}showSaveBeatModal(e={},t=null){try{const a="save-beat-modal";let i=this.modals.get(a);return i||(i=this.createModal(a,this.templates.saveBeat),this.modals.set(a,i)),i.dataset.beatData=JSON.stringify(e),t&&"function"==typeof t&&(i.dataset.onSave="true",i.onSave=t),this.showModal(i),!0}catch(e){return!1}}hideSaveBeatModal(){return this.hideModal("save-beat-modal")}createModal(e,t){const a=document.createElement("div");a.id=e,a.className="modal",a.innerHTML=t,a.style.cssText=`\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%) scale(0.9);\n      background-color: var(--background-primary);\n      border: 1px solid var(--border-color);\n      border-radius: 8px;\n      padding: 24px;\n      min-width: 400px;\n      max-width: 90vw;\n      max-height: 90vh;\n      overflow-y: auto;\n      z-index: 9999;\n      opacity: 0;\n      visibility: hidden;\n      transition: all ${d.ANIMATION_DURATION}ms ease;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n    `;const i=a.querySelector(".modal-close");i&&i.addEventListener("click",()=>this.handleModalClose(a));const s=a.querySelector("form");return s&&s.addEventListener("submit",e=>this.handleFormSubmit(e,a)),a}createBeatSelectionTemplate(){return'\n      <div class="modal-header">\n        <h3>Load Beat</h3>\n        <button type="button" class="modal-close" aria-label="Close">&times;</button>\n      </div>\n      <div class="modal-body">\n        <div class="beat-list">\n          <p class="no-beats-message" style="display: none; color: var(--text-secondary); text-align: center;">\n            No saved beats found. Create and save a beat first.\n          </p>\n          <div class="beat-items"></div>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" onclick="this.closest(\'.modal\').dispatchEvent(new Event(\'close\'))">\n          Cancel\n        </button>\n      </div>\n    '}createSaveBeatTemplate(){return`\n      <div class="modal-header">\n        <h3>Save Beat</h3>\n        <button type="button" class="modal-close" aria-label="Close">&times;</button>\n      </div>\n      <div class="modal-body">\n        <form class="save-beat-form">\n          <div class="form-group">\n            <label for="beat-name">Beat Name:</label>\n            <input type="text" id="beat-name" name="beatName" required \n                   maxlength="${m.BEAT_NAME.maxLength}" \n                   placeholder="Enter a name for your beat">\n            <div class="error-message" style="display: none; color: var(--error-color); font-size: 12px;"></div>\n          </div>\n          <div class="form-group">\n            <label for="beat-description">Description (optional):</label>\n            <textarea id="beat-description" name="beatDescription" \n                      placeholder="Add a description for your beat"></textarea>\n          </div>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').dispatchEvent(new Event('close'))">\n          Cancel\n        </button>\n        <button type="submit" form="save-beat-form" class="btn btn-primary">\n          Save Beat\n        </button>\n      </div>\n    `}populateBeatList(e,t){const a=e.querySelector(".beat-items"),i=e.querySelector(".no-beats-message");a&&(a.innerHTML="",t&&0!==t.length?(i&&(i.style.display="none"),t.forEach(t=>{const i=document.createElement("div");i.className="beat-item",i.style.cssText="\n        padding: 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 4px;\n        margin-bottom: 8px;\n        cursor: pointer;\n        transition: background-color 0.2s ease;\n      ",i.innerHTML=`\n        <div class="beat-name" style="font-weight: bold; margin-bottom: 4px;">${t.name}</div>\n        <div class="beat-info" style="font-size: 12px; color: var(--text-secondary);">\n          Tempo: ${t.data?.tempo||"N/A"} BPM | \n          Pattern: ${t.data?.patternLength||"N/A"} steps |\n          Last used: ${new Date(t.lastUsed).toLocaleDateString()}\n        </div>\n      `,i.addEventListener("click",()=>{this.handleBeatSelection(e,t)}),i.addEventListener("mouseenter",()=>{i.style.backgroundColor="var(--background-secondary)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor="transparent"}),a.appendChild(i)})):i&&(i.style.display="block"))}handleBeatSelection(e,t){e.onBeatSelect&&"function"==typeof e.onBeatSelect&&e.onBeatSelect(t),this.hideModal(e.id)}handleFormSubmit(e,t){e.preventDefault();const a=new FormData(e.target),i=a.get("beatName")?.trim(),s=a.get("beatDescription")?.trim();if(!i||i.length<m.BEAT_NAME.minLength)return void this.showFormError(t,h.BEAT_NAME_EMPTY);if(i.length>m.BEAT_NAME.maxLength)return void this.showFormError(t,`Beat name too long (max ${m.BEAT_NAME.maxLength} characters)`);let n={};try{n=JSON.parse(t.dataset.beatData||"{}")}catch(e){n={}}const r={name:i,description:s,data:n};if(t.onSave&&"function"==typeof t.onSave){const e=t.onSave(r);e&&e.success?this.hideModal(t.id):this.showFormError(t,e?.message||"Failed to save beat")}}showFormError(e,t){const a=e.querySelector(".error-message");a&&(a.textContent=t,a.style.display="block",setTimeout(()=>{a.style.display="none"},5e3))}showModal(e){this.activeModal&&this.hideModal(this.activeModal.id),document.body.appendChild(e),this.modalBackdrop&&(this.modalBackdrop.style.visibility="visible",this.modalBackdrop.style.opacity="1"),requestAnimationFrame(()=>{e.style.visibility="visible",e.style.opacity="1",e.style.transform="translate(-50%, -50%) scale(1)"}),this.activeModal=e;const t=e.querySelector("input, textarea, button");t&&t.focus()}hideModal(e){try{const t="string"==typeof e?this.modals.get(e):e;return!!t&&(t.style.opacity="0",t.style.transform="translate(-50%, -50%) scale(0.9)",setTimeout(()=>{t.style.visibility="hidden",t.parentNode&&t.parentNode.removeChild(t),this.activeModal===t&&(this.activeModal=null,this.modalBackdrop&&(this.modalBackdrop.style.opacity="0",setTimeout(()=>{this.modalBackdrop.style.visibility="hidden"},d.ANIMATION_DURATION)))},d.ANIMATION_DURATION),!0)}catch(e){return!1}}handleModalClose(e){this.hideModal(e.id)}handleBackdropClick(e){e.target===this.modalBackdrop&&this.activeModal&&this.hideModal(this.activeModal.id)}handleEscapeKey(e){"Escape"===e.key&&this.activeModal&&this.hideModal(this.activeModal.id)}getSelectedBeat(){return null}getSaveBeatData(){return null}isModalVisible(e){const t=this.modals.get(e);return t&&"visible"===t.style.visibility}getState(){return{isInitialized:this.isInitialized,activeModal:this.activeModal?.id||null,totalModals:this.modals.size,visibleModals:Array.from(this.modals.keys()).filter(e=>this.isModalVisible(e))}}destroy(){try{this.modals.forEach((e,t)=>{this.hideModal(t)}),this.modalBackdrop&&this.modalBackdrop.parentNode&&this.modalBackdrop.parentNode.removeChild(this.modalBackdrop),document.removeEventListener("keydown",this.handleEscapeKey),this.modals.clear(),this.activeModal=null,this.modalBackdrop=null,this.isInitialized=!1}catch(e){}}}class v{constructor(e,t,a){this.audioManager=e,this.beatStorage=t,this.pianoManager=a,this.sequencerManager=null,this.controlManager=null,this.modalManager=null,this.currentBeat=null,this.isInitialized=!1,this.statusElement=null,this.handleTempoChange=this.handleTempoChange.bind(this),this.handlePatternLengthChange=this.handlePatternLengthChange.bind(this),this.handlePlayStateChange=this.handlePlayStateChange.bind(this),this.handleRecordingChange=this.handleRecordingChange.bind(this),this.handleClear=this.handleClear.bind(this)}async initialize(){try{return await this.audioManager.initialize(),this.initializeUIManagers(),this.setupEventHandlers(),await this.initializeApplicationState(),await this.initializePiano(),this.isInitialized=!0,!0}catch(e){return this.updateStatus(h.INITIALIZATION_FAILED),!1}}initializeUIManagers(){const e=document.getElementById("sequencer-grid");if(!e)throw new Error("Required DOM containers not found");this.sequencerManager=new b(e,{onStepToggle:this.handleStepToggle.bind(this),onPatternLengthChange:this.handlePatternLengthChange.bind(this)}),this.modalManager=new f,this.modalManager.initialize(),this.sequencerManager.createGrid(),this.setupControlEventHandlers()}setupEventHandlers(){const e=async e=>{if(!e.target.closest("#piano-header"))try{await this.audioManager.resumeAudioContext()}catch(e){}};document.addEventListener("click",e),document.addEventListener("touchstart",e),document.addEventListener("keydown",e),this.startAudioHealthCheck()}setupControlEventHandlers(){const e=document.getElementById("play-btn");e&&e.addEventListener("click",()=>this.handlePlayStateChange(!0));const t=document.getElementById("stop-btn");t&&t.addEventListener("click",()=>this.handlePlayStateChange(!1));const a=document.getElementById("clear-btn");a&&a.addEventListener("click",()=>this.handleClear());const i=document.getElementById("tempo");i&&i.addEventListener("input",e=>{this.handleTempoChange(parseInt(e.target.value))});const s=document.getElementById("pattern-length");s&&s.addEventListener("change",e=>{this.handlePatternLengthChange(parseInt(e.target.value))});const n=document.getElementById("share-btn");n&&n.addEventListener("click",()=>this.shareBeat());const r=document.getElementById("load-btn");r&&r.addEventListener("click",()=>this.showBeatSelectionModal());const o=document.getElementById("load-url-btn");o&&o.addEventListener("click",()=>this.promptForURL());const l=document.getElementById("save-local-btn");l&&l.addEventListener("click",()=>this.showSaveBeatModal());const d=document.getElementById("theme-toggle");d&&d.addEventListener("click",()=>this.toggleTheme()),document.querySelectorAll(".drum-pad").forEach(e=>{e.addEventListener("click",()=>this.playSound(e.dataset.sound))}),document.querySelectorAll(".mute-btn").forEach(e=>{e.addEventListener("click",()=>this.toggleMute(e.dataset.drum))})}async initializeApplicationState(){try{const e=new URLSearchParams(window.location.search).get("beat");e?(await this.loadBeatFromURL(e),this.updateStatus(c.BEAT_LOADED_FROM_URL)):await this.loadLastUsedBeat()}catch(e){this.currentBeat=y(),this.updateStatus("Using default beat")}}async initializePiano(){try{const e=document.getElementById("piano-keys");e&&await this.pianoManager.initialize(e)}catch(e){}}promptForURL(){try{const e=prompt("Enter the URL with beat data:");if(e){const t=new URLSearchParams(e.split("?")[1]).get("beat");t?this.loadBeatFromURL(t):this.updateStatus("No beat data found in URL")}}catch(e){this.updateStatus("Invalid URL format")}}async loadBeatFromURL(e){try{const t=this.decodeBeatData(e);if(t)return this.currentBeat=t,this.updateSequencerDisplay(),this.updateStatus(c.BEAT_LOADED_FROM_URL),!0}catch(e){this.updateStatus(h.INVALID_URL_DATA)}return!1}async loadLastUsedBeat(){try{const e=this.beatStorage.getLastUsedBeat();if(e)return this.currentBeat=e,this.updateSequencerDisplay(),this.updateStatus(`Loaded: ${e.name}`),!0}catch(e){}return!1}async loadBeat(e){try{const t=this.beatStorage.loadBeat(e);if(t)return this.currentBeat=t,this.updateSequencerDisplay(),this.updateStatus(`Loaded: ${t.name}`),!0}catch(e){this.updateStatus(h.LOAD_FAILED)}return!1}async saveBeat(e,t=!1){try{if(!this.currentBeat)throw new Error("No beat to save");if(this.beatStorage.saveBeat(e,this.currentBeat,t))return this.updateStatus(c.BEAT_SAVED),!0}catch(e){this.updateStatus(h.SAVE_FAILED)}return!1}shareBeat(){try{if(!this.currentBeat)throw new Error("No beat to share");const e=this.optimizeBeatData(this.currentBeat),t=this.encodeBeatData(e),a=`${window.location.origin}${window.location.pathname}?beat=${t}`;return navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(a).then(()=>{this.updateStatus(c.LINK_COPIED)}).catch(()=>{this.fallbackCopyToClipboard(a)}):this.fallbackCopyToClipboard(a),a}catch(e){return this.updateStatus(h.SHARE_FAILED),null}}fallbackCopyToClipboard(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.updateStatus(c.LINK_COPIED)}catch(e){this.updateStatus(h.COPY_FAILED)}document.body.removeChild(t)}showBeatSelectionModal(){try{const e=this.beatStorage.loadAllBeats();this.modalManager.showBeatSelectionModal(e,e=>{this.loadBeat(e.name),this.modalManager.hideBeatSelectionModal()})}catch(e){this.updateStatus(h.MODAL_FAILED)}}showSaveBeatModal(){try{this.modalManager.showSaveBeatModal(this.currentBeat,async(e,t)=>{await this.saveBeat(e,t)&&this.modalManager.hideSaveBeatModal()})}catch(e){this.updateStatus(h.MODAL_FAILED)}}handleStepToggle(e,t){if(!this.currentBeat||!this.currentBeat.sequencer)return;const a=this.currentBeat.sequencer[e][t];this.currentBeat.sequencer[e][t]=!a,this.sequencerManager.setStepState(e,t,!a)}handleTempoChange(e){this.currentBeat&&(this.currentBeat.tempo=e)}handlePatternLengthChange(e){this.currentBeat&&this.currentBeat.sequencer&&(this.sequencerManager.updateGridSize(e),Object.keys(this.currentBeat.sequencer).forEach(t=>{const a=this.currentBeat.sequencer[t];a.length!==e&&(e>a.length?this.currentBeat.sequencer[t]=[...a,...new Array(e-a.length).fill(!1)]:this.currentBeat.sequencer[t]=a.slice(0,e))}),this.updateSequencerDisplay())}handlePlayStateChange(e){e?this.startPlayback():this.stopPlayback()}handleRecordingChange(e){e?this.startRecording():this.stopRecording()}handleClear(){this.clearBeat()}startPlayback(){if(this.currentBeat&&this.sequencerManager)try{this.sequencerManager.startPlayback(this.currentBeat.tempo),this.updateStatus("Playing...")}catch(e){this.updateStatus(h.PLAYBACK_FAILED)}}stopPlayback(){this.sequencerManager&&(this.sequencerManager.stopPlayback(),this.updateStatus("Stopped"))}startRecording(){this.updateStatus("Recording started")}playSound(e){try{this.audioManager&&this.audioManager.isInitialized&&this.updateStatus(`Playing ${e} sound`)}catch(e){}}toggleMute(e){try{this.updateStatus(`Toggled mute for ${e}`)}catch(e){}}toggleTheme(){try{const e=document.body;e.classList.contains("dark-theme")?(e.classList.remove("dark-theme"),localStorage.setItem("theme","light"),this.updateStatus("Switched to light theme")):(e.classList.add("dark-theme"),localStorage.setItem("theme","dark"),this.updateStatus("Switched to dark theme"))}catch(e){}}stopRecording(){this.updateStatus("Recording stopped")}clearBeat(){this.currentBeat=y(),this.updateSequencerDisplay(),this.updateStatus("Beat cleared")}updateSequencerDisplay(){this.sequencerManager&&this.currentBeat&&this.sequencerManager.setSequencerData(this.currentBeat.sequencer)}updateStatus(e){this.statusElement||(this.statusElement=document.getElementById("status-text")),this.statusElement&&(this.statusElement.textContent=e)}startAudioHealthCheck(){setInterval(()=>{if(this.audioManager){this.audioManager.checkAudioContextHealth().healthy}},1e4)}optimizeBeatData(e){if(!e||!e.sequencer)return e;const t={tempo:e.tempo,sequencer:{}};return Object.keys(e.sequencer).forEach(a=>{const i=e.sequencer[a];i.some(e=>!0===e)&&(t.sequencer[a]=i.map((e,t)=>e?t:-1).filter(e=>-1!==e))}),t}encodeBeatData(e){try{const t=JSON.stringify(e);return btoa(t)}catch(e){throw e}}decodeBeatData(e){try{const t=atob(e),a=JSON.parse(t);return this.expandBeatData(a)}catch(e){throw e}}expandBeatData(e){if(!e||!e.sequencer)return y();const t=y(),a={tempo:e.tempo||t.tempo,sequencer:{}};return Object.keys(t.sequencer).forEach(i=>{const s=t.sequencer[i],n=s.length;if(e.sequencer[i]){const t=new Array(n).fill(!1);e.sequencer[i].forEach(e=>{e>=0&&e<n&&(t[e]=!0)}),a.sequencer[i]=t}else a.sequencer[i]=[...s]}),a}getState(){return{isInitialized:this.isInitialized,currentBeat:this.currentBeat,audioManager:this.audioManager?.getState(),beatStorage:this.beatStorage?.getState(),pianoManager:this.pianoManager?.getState(),sequencerManager:this.sequencerManager?.getState(),modalManager:this.modalManager?.getState()}}destroy(){try{this.stopPlayback(),this.sequencerManager&&this.sequencerManager.destroy(),this.modalManager&&this.modalManager.destroy(),this.pianoManager&&this.pianoManager.destroy(),this.audioManager&&this.audioManager.destroy(),document.removeEventListener("click",this.resumeAudioOnInteraction),document.removeEventListener("touchstart",this.resumeAudioOnInteraction),document.removeEventListener("keydown",this.resumeAudioOnInteraction)}catch(e){}}}return document.addEventListener("DOMContentLoaded",()=>{try{const e=new t,a=new A,i=new T(e),s=new v(e,a,i);"development"===process.env.NODE_ENV&&(window.drumMachine=s,window.audioManager=e,window.beatStorage=a,window.pianoManager=i,window.CONSTANTS=S)}catch(e){const t=document.getElementById("status");t&&(t.textContent="Failed to initialize. Please refresh the page.")}}),e.AudioManager=t,e.BeatStorage=A,e.CONSTANTS=S,e.DrumMachine=v,e.PianoManager=T,e}({});
//# sourceMappingURL=script.js.map
